var nodechat=$.cookie("nodechat")?$.cookie("nodechat").split("_"):"1 450 275 55 5 1 2".split(" ");
$(function(){socket=io.connect("http://megafile.ws:8282");2==nodechat[6]&&(nodechat[6]=1550<=$(window).width()?1:0);$("#nodechat_btn").click(function(){1==nodechat[0]?(nodechat_close(),nodechat[0]=0):(nodechat_open(),nodechat[0]=1);nodechat_setings_save();return!1});socket.on("chat_join",function(){"1"==nodechat[0]&&(nodechat_open(),$("#nodechat_btn").addClass("onChat"))});socket.on("chat_init",function(a){$("#nodechat").remove();1==nodechat[6]?$("body").prepend(a):$("#mainContent").prepend(a);nodechat_init()});
socket.on("chat_msg2client",function(a){if(a.info)$("#nodechat_msg_list").prepend(a.info),setTimeout(function(){$(".nodechat_info").fadeTo(750,0,function(){$("div").remove(".nodechat_info")})},5E3);else{if(a.del){var c=a.del.split(", "),b;for(b in c)$("#nodechat_mess_"+b).remove()}a.message&&($("#nodechat_msg_list").prepend(a.message),5==dle_group&&$("a").remove(".nodechat_pm"),2<dle_group&&$("a").remove(".nodechat_mess_del"))}})});
function nodechat_open(){socket.emit("join2chat");$("#nodechat_btn").addClass("onChat")}function nodechat_close(){socket.emit("leave_chat");$("#nodechat_btn").removeClass("onChat");$("#nodechat").hide("slide",100,function(){$(this).remove()})}function nodechat_location(){}function nodechat_setings_save(){$.cookie("nodechat",nodechat.join("_"),{expires:365,path:"/"})}
function nodechat_init(){nodechat_input();5==dle_group&&$("a").remove(".nodechat_pm");2<dle_group&&$("a").remove(".nodechat_mess_del");1==nodechat[6]?($("#nodechat").css({height:nodechat[1]}).css({width:nodechat[2]}),nodechat_messheight(),1==nodechat[5]?($("#nodechat").css({position:"fixed"}),$("#nodechat_icons_unlocked").hide()):($("#nodechat").css({position:"absolute"}),$("#nodechat_icons_locked").hide()),$("#nodechat").resizable({minHeight:200,minWidth:237,helper:"ui-resizable-helper",stop:function(a,
c){nodechat[1]=c.size.height-2;nodechat[2]=c.size.width-2;1==nodechat[5]&&$("#nodechat").css({position:"fixed"});nodechat_messheight();nodechat_setings_save()}}).draggable({handle:"#nodechat_head",containment:"document",scroll:!1,stop:function(a,c){nodechat[3]=c.offset.top;nodechat[4]=c.offset.left;nodechat_setings_save()}}).offset({top:nodechat[3],left:nodechat[4]}).show("slide",100)):($("#nodechat").css({height:"300px"}),$("#nodechat_msg_list").css({height:"200px"}),$("#nodechat_icons_unlocked").hide(),
$("#nodechat_icons_locked").hide(),$("#nodechat").show("slide",100));$("#nodechat_icons li").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});$("#nodechat_icons_locked").click(function(){nodechat[5]=0;$("#nodechat").css({position:"absolute"});$("#nodechat_icons_locked").hide();$("#nodechat_icons_unlocked").show();nodechat_setings_save();return!1});$("#nodechat_icons_unlocked").click(function(){$("#nodechat").css({position:"fixed"});$("#nodechat_icons_unlocked").hide();
$("#nodechat_icons_locked").show();nodechat[5]=1;nodechat_setings_save();return!1});$("#nodechat_icons_close").click(function(){nodechat_close();nodechat[0]=0;nodechat_setings_save();return!1});$("#nodechat_icons_newwin").click(function(){nodechat[6]="1"==nodechat[6]?0:1;nodechat_setings_save();$("#nodechat").remove();nodechat_open();nodechat_init();return!1})}function nodechat_messheight(){$("#nodechat_msg_list").css({height:nodechat[1]-106+"px"})}
function nodechat_input(){$("#nodechat_input").markItUp({resizeHandle:!1,markupSet:[{name:"B",key:"B",openWith:"[b]",closeWith:"[/b]"},{name:"I",key:"I",openWith:"[i]",closeWith:"[/i]"},{name:"U",key:"U",openWith:"[u]",closeWith:"[/u]"},{separator:"-"},{name:"Link",key:"L",openWith:"[url=[![Url]!]]",closeWith:"[/url]",placeHolder:"Text"},{name:":)",dropMenu:[{className:"smile01",openWith:":) "},{className:"smile02",openWith:":D "},{className:"smile03",openWith:"LOL "},{className:"smile04",openWith:":P "},
{className:"smile05",openWith:":yes: "},{className:"smile06",openWith:":( "},{className:"smile07",openWith:";) "},{className:"smile08",openWith:":'( "},{className:"smile09",openWith:":! "},{className:"smile10",openWith:":no: "}]},{separator:"-"},{name:"Convert",beforeInsert:function(){memchat_text_convert()}},{name:"Send [Enter]",beforeInsert:function(){nodechat_mess_send()}}]});ctrl=!1;$("#nodechat_input").keydown(function(a){switch(a.which){case 13:return!1;case 17:ctrl=!0}});$("#nodechat_input").keyup(function(a){switch(a.which){case 13:if(!ctrl)return nodechat_mess_send(),
!1;$("#nodechat_input").focus().val($("#nodechat_input").val()+"\r\n");break;case 17:ctrl=!1}})}
function memchat_text_convert(){for(var a="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz<,>:;\"'{}".split(""),c="\u0424\u0444\u0418\u0438\u0421\u0441\u0412\u0432\u0423\u0443\u0410\u0430\u041f\u043f\u0420\u0440\u0428\u0448\u041e\u043e\u041b\u043b\u0414\u0434\u042c\u044c\u0422\u0442\u0429\u0449\u0417\u0437\u0419\u0439\u041a\u043a\u042b\u044b\u0415\u0435\u0413\u0433\u041c\u043c\u0426\u0446\u0427\u0447\u041d\u043d\u042f\u044f\u0411\u0431\u042e\u0416\u0436\u042d\u044d\u0425\u042a".split(""),b=$("#nodechat_input").val(),
b=b.replace(/\./g,"\u044e"),b=b.replace(/\[/g,"\u0445"),b=b.replace(/\]/g,"\u044a"),d=0;d<a.length;d++)b=b.replace(RegExp(a[d],"g"),c[d]);$("#nodechat_input").val(b)}function nodechat_mess_send(){var a=$("#nodechat_input").val();$("#nodechat_input").val("");socket.emit("chat_msg2server",a)}function nodechat_mess_del(a){socket.emit("del_msg",a);return!1}function nodechat_reply(a){$("#nodechat_input").focus().val($("#nodechat_input").val()+"[to]"+a+"[/to], ");return!1}
function nodechat_PM(a){$("#nodechat_input").focus().val("[PM]"+a+"[/PM]: ");return!1}var timer_of_nodechat=[];function nodechat_action(a){$("#nodechat_date_"+a).hide();$("#nodechat_edit_"+a).show();timer_of_nodechat[a]=setTimeout(function(){$("#nodechat_edit_"+a).hide();$("#nodechat_date_"+a).show()},8E3);return!1};